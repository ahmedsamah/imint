---
title: "Tourism"
output: 
  pdf_document:
    latex_engine: xelatex
editor_options:
  chunk_output_type: console
header-includes:
  - \usepackage{adjustbox}
  - \usepackage{longtable}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(kableExtra)
```

- Forecasts for all series conducted using
  - ETS: `ets()` from `forecast` package
  - ARIMA: `auto.arima()` from `forecast` package
  
- Expanding window forecasts
  - Initial training window 96 months (8 years)
  - Expand the window by one period each time
  - Conducted forecasts for h=1, 3, 6, and 12
     - 168 1-step-ahead forecasts
     - 166 3-step-ahead forecasts
     - 163 6-step-ahead forecasts
     - 157 12-step-ahead forecasts
     
- Reconciliation conducted with immutability constraints under four weighting schemes for both the methods (I and I-MinT)
  - MinT(Sample) approach not considered, because sample variance-covariance is not a positive definite matrix due to number of observations per series (264) being less than the total number of series in the structure (425).
     
- Forecast accuracies measured by MSE
- Tables: 
  - `Base` show the average MSE ($\times10^3$) for the base forecasts.
  - A positive (negative) entry in other rows shows a percentage increase (decrease) in average MSE relative to the base forecasts. 
    - I refers to immutablility method of Zhang et. al
    - I-MinT refers to the method proposed in this paper


\newpage
## ETS 
```{r include=FALSE}
pc1 <- read_csv("pc/pc1.csv")
pc3 <- read_csv("pc/pc3.csv")
pc6 <- read_csv("pc/pc6.csv")
pc12 <- read_csv("pc/pc12.csv")
pc1to3 <- read_csv("pc/pc1to3.csv")
pc1to6 <- read_csv("pc/pc1to6.csv")
pc1to12 <- read_csv("pc/pc1to12.csv")

cnames <- c("Method", "h = 1", "3", "6", "12", "1-3", "1-6", "1-12")
cnames2 <- c("M", "h1", "h3", "h6", "h12", "h1-3", "h1-6", "h1-12")

australia <- data.frame("method" = pc1[,1], 
                        "h = 1" = pc1[,2],
                        "3" = pc3[,2],
                        "6" = pc6[,2],
                        "12" = pc12[,2],
                        "1-3" = pc1to3[,2],
                        "1-6" = pc1to6[,2],
                        "1-12" = pc1to12[,2]) %>% 
  mutate(across(where(is.numeric), ~ round(., 1)))
colnames(australia) <- cnames

purpose <- data.frame("method" = pc1[,1], 
                        "h = 1" = pc1[,5],
                        "3" = pc3[,5],
                        "6" = pc6[,5],
                        "12" = pc12[,5],
                        "1-3" = pc1to3[,5],
                        "1-6" = pc1to6[,5],
                        "1-12" = pc1to12[,5]) %>% 
  mutate(across(where(is.numeric), ~ round(., 1)))
colnames(purpose) <- cnames2

states <- data.frame("method" = pc1[,1], 
                        "h = 1" = pc1[,3],
                        "3" = pc3[,3],
                        "6" = pc6[,3],
                        "12" = pc12[,3],
                        "1-3" = pc1to3[,3],
                        "1-6" = pc1to6[,3],
                        "1-12" = pc1to12[,3]) %>% 
  mutate(across(where(is.numeric), ~ round(., 1)))
colnames(states) <- cnames

states_purpose <- data.frame("method" = pc1[,1], 
                        "h = 1" = pc1[,6],
                        "3" = pc3[,6],
                        "6" = pc6[,6],
                        "12" = pc12[,6],
                        "1-3" = pc1to3[,6],
                        "1-6" = pc1to6[,6],
                        "1-12" = pc1to12[,6]) %>% 
  mutate(across(where(is.numeric), ~ round(., 1)))
colnames(states_purpose) <- cnames2

regions <- data.frame("method" = pc1[,1], 
                        "h = 1" = pc1[,4],
                        "3" = pc3[,4],
                        "6" = pc6[,4],
                        "12" = pc12[,4],
                        "1-3" = pc1to3[,4],
                        "1-6" = pc1to6[,4],
                        "1-12" = pc1to12[,4]) %>% 
  mutate(across(where(is.numeric), ~ round(., 1)))
colnames(regions) <- cnames


regions_purpose <- data.frame("method" = pc1[,1], 
                        "h = 1" = pc1[,7],
                        "3" = pc3[,7],
                        "6" = pc6[,7],
                        "12" = pc12[,7],
                        "1-3" = pc1to3[,7],
                        "1-6" = pc1to6[,7],
                        "1-12" = pc1to12[,7]) %>% 
  mutate(across(where(is.numeric), ~ round(., 1)))
colnames(regions_purpose) <- cnames2

all_series <- data.frame("method" = pc1[,1], 
                        "h = 1" = pc1[,8],
                        "3" = pc3[,8],
                        "6" = pc6[,8],
                        "12" = pc12[,8],
                        "1-3" = pc1to3[,8],
                        "1-6" = pc1to6[,8],
                        "1-12" = pc1to12[,8]) %>% 
  mutate(across(where(is.numeric), ~ round(., 1)))
colnames(all_series) <- cnames
```

```{r, results = 'asis'}
aus <- cbind(australia, purpose[,-1]) %>% 
  slice(c(1, 2, 6, 3, 7, 4, 8, 5, 9)) %>% 
  mutate(W = c("Base", "OLS", "OLS", "WLSs", "WLSs", "WLSv", "WLSv", "MinT(Shrink)", "MinT(Shrink)"),
    ImmuteMethod = c(" ", "I", "I-MinT", "I", "I-MinT", "I", "I-MinT", "I", "I-MinT")) %>% 
  select(c(16,17,2:15)) %>% 
  select(-7) %>% 
  select(-13)
  
state <- cbind(states, states_purpose[,-1]) %>% 
  slice(c(1, 2, 6, 3, 7, 4, 8, 5, 9)) %>% 
  mutate(W = c("Base", "OLS", "OLS", "WLSs", "WLSs", "WLSv", "WLSv", "MinT(Shrink)", "MinT(Shrink)"),
    ImmuteMethod = c(" ", "I", "I-MinT", "I", "I-MinT", "I", "I-MinT", "I", "I-MinT")) %>% 
  select(c(16,17,2:15)) %>% 
  select(-7) %>% 
  select(-13)

region <- cbind(regions, regions_purpose[,-1]) %>% 
  slice(c(1, 2, 6, 3, 7, 4, 8, 5, 9)) %>% 
  mutate(W = c("Base", "OLS", "OLS", "WLSs", "WLSs", "WLSv", "WLSv", "MinT(Shrink)", "MinT(Shrink)"),
    ImmuteMethod = c(" ", "I", "I-MinT", "I", "I-MinT", "I", "I-MinT", "I", "I-MinT")) %>% 
  select(c(16,17,2:15)) %>% 
  select(-7) %>% 
  select(-13)

allseries <- all_series %>% slice(c(1, 2, 6, 3, 7, 4, 8, 5, 9)) %>% 
  mutate(W = c("Base", "OLS", "OLS", "WLSs", "WLSs", "WLSv", "WLSv", "MinT(Shrink)", "MinT(Shrink)"),
    ImmuteMethod = c(" ", "I", "I-MinT", "I", "I-MinT", "I", "I-MinT", "I", "I-MinT")) %>%
  select(c(9:10, 2:8)) %>% 
  select(-7)

# aus %>% write.csv("tables/aus.csv")
# state %>% write.csv("tables/state.csv")
# region %>% write.csv("tables/region.csv")
# allseries %>% write.csv("tables/allseries.csv")

aus_table <- aus %>% 
  kable(escape = FALSE,
        caption="\\label{tab:tourismets}Out-of-sample forecast accuracies for Australian domestic tourism flows.",
        col.names = c(" ", " ", "h = 1", "3", "6", "12", "1-6", "1-12", "h = 1", "3", "6", "12", "1-6", "1-12")
        ) %>% 
  kable_styling(full_width = FALSE,
                latex_options = c("hold_position"),
                font_size = 7) %>% 
  add_header_above(c(" " =2, "Australia" = 6, "Australia by purpose of travel" = 6), bold = TRUE) %>% 
  add_header_above(c("ETS"=14), bold = TRUE) %>% 
  column_spec(c(1), width = "1.5cm") %>% 
  column_spec(c(2), width = "1cm") %>%
  # column_spec(3, bold = ifelse(aus$`h = 1`==min(aus$`h = 1`), T, F), width = "0.7cm") %>% 
  # column_spec(4, bold = ifelse(aus$`3`==min(aus$`3`), T, F), width = "0.7cm") %>% 
  # column_spec(5, bold = ifelse(aus$`6`==min(aus$`6`), T, F), width = "0.7cm") %>% 
  # column_spec(6, bold = ifelse(aus$`12`==min(aus$`12`), T, F), width = "0.7cm") %>% 
  # column_spec(7, bold = ifelse(aus$`1-6`==min(aus$`1-6`), T, F), width = "0.7cm") %>% 
  # column_spec(8, bold = ifelse(aus$`1-12`==min(aus$`1-12`), T, F), width = "0.7cm") %>% 
  column_spec(3:8, width = "0.7cm") %>% 
  column_spec(9, bold = ifelse(aus$`h1`==min(aus$`h1`), T, F), width = "0.7cm") %>% 
  column_spec(10, bold = ifelse(aus$`h3`==min(aus$`h3`), T, F), width = "0.7cm") %>% 
  column_spec(11, bold = ifelse(aus$`h6`==min(aus$`h6`), T, F), width = "0.7cm") %>% 
  column_spec(12, bold = ifelse(aus$`h12`==min(aus$`h12`), T, F), width = "0.7cm") %>% 
  column_spec(13, bold = ifelse(aus$`h1-6`==min(aus$`h1-6`), T, F), width = "0.7cm") %>% 
  column_spec(14, bold = ifelse(aus$`h1-12`==min(aus$`h1-12`), T, F), width = "0.8cm") %>% 
  row_spec(1, bold = FALSE, italic = TRUE) %>% 
  collapse_rows(1, latex_hline ="major")


state_table <- state %>%
  kable(escape = FALSE,
        col.names = c(" ", " ", "h = 1", "3", "6", "12", "1-6", "1-12", "h = 1", "3", "6", "12", "1-6", "1-12")
       ) %>% 
  kable_styling(full_width = FALSE,
                latex_options = c("hold_position"),
                font_size = 7) %>% 
  add_header_above(c(" "=2, "States" = 6, "States by purpose of travel" = 6), bold = TRUE)%>% 
  column_spec(c(1), width = "1.5cm") %>% 
  # column_spec(c(2), width = "1cm") %>%
  column_spec(3, bold = ifelse(state$`h = 1`==min(state$`h = 1`), T, F), width = "0.7cm") %>% 
  column_spec(4, bold = ifelse(state$`3`==min(state$`3`), T, F), width = "0.7cm") %>% 
  column_spec(5, bold = ifelse(state$`6`==min(state$`6`), T, F), width = "0.7cm") %>% 
  column_spec(6, bold = ifelse(state$`12`==min(state$`12`), T, F), width = "0.7cm") %>% 
  column_spec(7, bold = ifelse(state$`1-6`==min(state$`1-6`), T, F), width = "0.7cm") %>% 
  column_spec(8, bold = ifelse(state$`1-12`==min(state$`1-12`), T, F), width = "0.7cm") %>% 
  column_spec(9, bold = ifelse(state$`h1`==min(state$`h1`), T, F), width = "0.7cm") %>% 
  column_spec(10, bold = ifelse(state$`h3`==min(state$`h3`), T, F), width = "0.7cm") %>% 
  column_spec(11, bold = ifelse(state$`h6`==min(state$`h6`), T, F), width = "0.7cm") %>% 
  column_spec(12, bold = ifelse(state$`h12`==min(state$`h12`), T, F), width = "0.7cm") %>% 
  column_spec(13, bold = ifelse(state$`h1-6`==min(state$`h1-6`), T, F), width = "0.7cm") %>% 
  column_spec(14, bold = ifelse(state$`h1-12`==min(state$`h1-12`), T, F), width = "0.7cm") %>% 
  row_spec(1, bold = FALSE, italic = TRUE) %>% 
  collapse_rows(1, latex_hline ="major")


region_table <- region %>%
  kable(escape = FALSE,
        col.names = c(" ", " ", "h = 1", "3", "6", "12", "1-6", "1-12", "h = 1", "3", "6", "12", "1-6", "1-12")
        ) %>% 
  kable_styling(full_width = FALSE,
                latex_options = c("hold_position"),
                font_size = 7) %>% 
  add_header_above(c(" "=2, "Regions" = 6, "Regions by purpose of travel" = 6), bold = TRUE) %>% 
  column_spec(c(1), width = "1.5cm") %>% 
  column_spec(c(2), width = "1cm") %>%
  # column_spec(c(3:14), width = "1.5cm") %>%  
  column_spec(3, bold = ifelse(region$`h = 1`==min(region$`h = 1`), T, F), width = "0.7cm") %>% 
  column_spec(4, bold = ifelse(region$`3`==min(region$`3`), T, F), width = "0.7cm") %>% 
  column_spec(5, bold = ifelse(region$`6`==min(region$`6`), T, F), width = "0.7cm") %>% 
  column_spec(6, bold = ifelse(region$`12`==min(region$`12`), T, F), width = "0.7cm") %>% 
  column_spec(7, bold = ifelse(region$`1-6`==min(region$`1-6`), T, F), width = "0.7cm") %>% 
  column_spec(8, bold = ifelse(region$`1-12`==min(region$`1-12`), T, F), width = "0.7cm") %>% 
  column_spec(9, bold = ifelse(region$`h1`==min(region$`h1`[-1]), T, F), width = "0.7cm") %>% 
  column_spec(10, bold = ifelse(region$`h3`==min(region$`h3`[-1]), T, F), width = "0.7cm") %>% 
  column_spec(11, bold = ifelse(region$`h6`==min(region$`h6`[-1]), T, F), width = "0.7cm") %>% 
  column_spec(12, bold = ifelse(region$`h12`==min(region$`h12`[-1]), T, F), width = "0.7cm") %>% 
  column_spec(13, bold = ifelse(region$`h1-6`==min(region$`h1-6`[-1]), T, F), width = "0.7cm") %>% 
  column_spec(14, bold = ifelse(region$`h1-12`==min(region$`h1-12`[-1]), T, F), width = "0.7cm") %>% 
  row_spec(1, bold = FALSE, italic = TRUE) %>% 
  collapse_rows(1, latex_hline ="major")
  
allseries_table <- allseries %>%
  kable(escape = FALSE,
        col.names = c(" ", " ", "h = 1", "3", "6", "12", "1-6", "1-12")
        ) %>% 
  kable_styling(full_width = FALSE,
                latex_options = c("hold_position"),
                font_size = 7) %>% 
  add_header_above(c(" "=2, "All series" = 6), bold = TRUE) %>% 
  column_spec(c(1), width = "1.5cm") %>% 
  column_spec(c(2), width = "1cm") %>%
  #column_spec(c(3:8), width = "7cm") %>%  
  column_spec(3, bold = ifelse(allseries$`h = 1`==min(allseries$`h = 1`), T, F), width = "1.8cm") %>% 
  column_spec(4, bold = ifelse(allseries$`3`==min(allseries$`3`), T, F), width = "1.8cm") %>% 
  column_spec(5, bold = ifelse(allseries$`6`==min(allseries$`6`), T, F), width = "1.8cm") %>% 
  column_spec(6, bold = ifelse(allseries$`12`==min(allseries$`12`), T, F), width = "1.8cm") %>% 
  column_spec(7, bold = ifelse(allseries$`1-6`==min(allseries$`1-6`), T, F), width = "1.8cm") %>% 
  column_spec(8, bold = ifelse(allseries$`1-12`==min(allseries$`1-12`), T, F), width = "1.8cm") %>% 
  row_spec(1, bold = FALSE, italic = TRUE) %>% 
  collapse_rows(1, latex_hline ="major")

cat(paste0(aus_table, "\\vspace{-2.5em}", state_table, "\\vspace{-2.5em}", 
           region_table, "\\vspace{-2.5em}", allseries_table), sep = "")




```


\newpage
## ARIMA 
```{r include=FALSE}
pc1_arima <- read_csv("pc/pc1_arima.csv")
pc3_arima <- read_csv("pc/pc3_arima.csv")
pc6_arima <- read_csv("pc/pc6_arima.csv")
pc12_arima <- read_csv("pc/pc12_arima.csv")
pc1to3_arima <- read_csv("pc/pc1to3_arima.csv")
pc1to6_arima <- read_csv("pc/pc1to6_arima.csv")
pc1to12_arima <- read_csv("pc/pc1to12_arima.csv")

cnames <- c("Method", "h = 1", "3", "6", "12", "1-3", "1-6", "1-12")
cnames2 <- c("M", "h1", "h3", "h6", "h12", "h1-3", "h1-6", "h1-12")

australia_arima <- data.frame("method" = pc1_arima[,1], 
                        "h = 1" = pc1_arima[,2],
                        "3" = pc3_arima[,2],
                        "6" = pc6_arima[,2],
                        "12" = pc12_arima[,2],
                        "1-3" = pc1to3_arima[,2],
                        "1-6" = pc1to6_arima[,2],
                        "1-12" = pc1to12_arima[,2]) %>% 
  mutate(across(where(is.numeric), ~ round(., 1)))
colnames(australia_arima) <- cnames

purpose_arima <- data.frame("method" = pc1_arima[,1], 
                        "h = 1" = pc1_arima[,5],
                        "3" = pc3_arima[,5],
                        "6" = pc6_arima[,5],
                        "12" = pc12_arima[,5],
                        "1-3" = pc1to3_arima[,5],
                        "1-6" = pc1to6_arima[,5],
                        "1-12" = pc1to12_arima[,5]) %>% 
  mutate(across(where(is.numeric), ~ round(., 1)))
colnames(purpose_arima) <- cnames2

states_arima <- data.frame("method" = pc1_arima[,1], 
                        "h = 1" = pc1_arima[,3],
                        "3" = pc3_arima[,3],
                        "6" = pc6_arima[,3],
                        "12" = pc12_arima[,3],
                        "1-3" = pc1to3_arima[,3],
                        "1-6" = pc1to6_arima[,3],
                        "1-12" = pc1to12_arima[,3]) %>% 
  mutate(across(where(is.numeric), ~ round(., 1)))
colnames(states_arima) <- cnames

states_purpose_arima <- data.frame("method" = pc1_arima[,1], 
                        "h = 1" = pc1_arima[,6],
                        "3" = pc3_arima[,6],
                        "6" = pc6_arima[,6],
                        "12" = pc12_arima[,6],
                        "1-3" = pc1to3_arima[,6],
                        "1-6" = pc1to6_arima[,6],
                        "1-12" = pc1to12_arima[,6]) %>% 
  mutate(across(where(is.numeric), ~ round(., 1)))
colnames(states_purpose_arima) <- cnames2

regions_arima <- data.frame("method" = pc1_arima[,1], 
                        "h = 1" = pc1_arima[,4],
                        "3" = pc3_arima[,4],
                        "6" = pc6_arima[,4],
                        "12" = pc12_arima[,4],
                        "1-3" = pc1to3_arima[,4],
                        "1-6" = pc1to6_arima[,4],
                        "1-12" = pc1to12_arima[,4]) %>% 
  mutate(across(where(is.numeric), ~ round(., 1)))
colnames(regions_arima) <- cnames


regions_purpose_arima <- data.frame("method" = pc1_arima[,1], 
                        "h = 1" = pc1_arima[,7],
                        "3" = pc3_arima[,7],
                        "6" = pc6_arima[,7],
                        "12" = pc12_arima[,7],
                        "1-3" = pc1to3_arima[,7],
                        "1-6" = pc1to6_arima[,7],
                        "1-12" = pc1to12_arima[,7]) %>% 
  mutate(across(where(is.numeric), ~ round(., 1)))
colnames(regions_purpose_arima) <- cnames2

all_series_arima <- data.frame("method" = pc1_arima[,1], 
                        "h = 1" = pc1_arima[,8],
                        "3" = pc3_arima[,8],
                        "6" = pc6_arima[,8],
                        "12" = pc12_arima[,8],
                        "1-3" = pc1to3_arima[,8],
                        "1-6" = pc1to6_arima[,8],
                        "1-12" = pc1to12_arima[,8]) %>% 
  mutate(across(where(is.numeric), ~ round(., 1)))
colnames(all_series_arima) <- cnames
```

```{r, results = 'asis'}
aus_arima <- cbind(australia_arima, purpose_arima[,-1]) %>% 
  slice(c(1, 2, 6, 3, 7, 4, 8, 5, 9)) %>% 
  mutate(W = c("Base", "OLS", "OLS", "WLSs", "WLSs", "WLSv", "WLSv", "MinT(Shrink)", "MinT(Shrink)"),
    ImmuteMethod = c(" ", "I", "I-MinT", "I", "I-MinT", "I", "I-MinT", "I", "I-MinT")) %>% 
  select(c(16,17,2:15)) %>% 
  select(-7) %>% 
  select(-13)
  
state_arima <- cbind(states_arima, states_purpose_arima[,-1]) %>% 
  slice(c(1, 2, 6, 3, 7, 4, 8, 5, 9)) %>% 
  mutate(W = c("Base", "OLS", "OLS", "WLSs", "WLSs", "WLSv", "WLSv", "MinT(Shrink)", "MinT(Shrink)"),
    ImmuteMethod = c(" ", "I", "I-MinT", "I", "I-MinT", "I", "I-MinT", "I", "I-MinT")) %>% 
  select(c(16,17,2:15)) %>% 
  select(-7) %>% 
  select(-13)

region_arima <- cbind(regions_arima, regions_purpose_arima[,-1]) %>% 
  slice(c(1, 2, 6, 3, 7, 4, 8, 5, 9)) %>% 
  mutate(W = c("Base", "OLS", "OLS", "WLSs", "WLSs", "WLSv", "WLSv", "MinT(Shrink)", "MinT(Shrink)"),
    ImmuteMethod = c(" ", "I", "I-MinT", "I", "I-MinT", "I", "I-MinT", "I", "I-MinT")) %>% 
  select(c(16,17,2:15)) %>% 
  select(-7) %>% 
  select(-13)

allseries_arima <- all_series_arima %>% slice(c(1, 2, 6, 3, 7, 4, 8, 5, 9)) %>% 
  mutate(W = c("Base", "OLS", "OLS", "WLSs", "WLSs", "WLSv", "WLSv", "MinT(Shrink)", "MinT(Shrink)"),
    ImmuteMethod = c(" ", "I", "I-MinT", "I", "I-MinT", "I", "I-MinT", "I", "I-MinT")) %>%
  select(c(9:10, 2:8)) %>% 
  select(-7)



aus_table_arima <- aus_arima %>% 
  kable(escape = FALSE,
        caption="\\label{tab:tourismets}Out-of-sample forecast accuracies for Australian domestic tourism flows.",
        col.names = c(" ", " ", "h = 1", "3", "6", "12", "1-6", "1-12", "h = 1", "3", "6", "12", "1-6", "1-12")
        ) %>% 
  kable_styling(full_width = FALSE,
                latex_options = c("hold_position"),
                font_size = 7) %>% 
  add_header_above(c(" " =2, "Australia" = 6, "Australia by purpose of travel" = 6), bold = TRUE) %>% 
  add_header_above(c("ARIMA"=14), bold = TRUE) %>% 
  column_spec(c(1), width = "1.5cm") %>% 
  column_spec(c(2), width = "1cm") %>%
  # column_spec(3, bold = ifelse(aus_arima$`h = 1`==min(aus_arima$`h = 1`), T, F), width = "0.7cm") %>% 
  # column_spec(4, bold = ifelse(aus_arima$`3`==min(aus_arima$`3`), T, F), width = "0.7cm") %>% 
  # column_spec(5, bold = ifelse(aus_arima$`6`==min(aus_arima$`6`), T, F), width = "0.7cm") %>% 
  # column_spec(6, bold = ifelse(aus_arima$`12`==min(aus_arima$`12`), T, F), width = "0.7cm") %>% 
  # column_spec(7, bold = ifelse(aus_arima$`1-6`==min(aus_arima_arima$`1-6`), T, F), width = "0.7cm") %>% 
  # column_spec(8, bold = ifelse(aus_arima$`1-12`==min(aus_arima$`1-12`), T, F), width = "0.7cm") %>% 
  column_spec(3:8, width = "0.7cm") %>% 
  column_spec(9, bold = ifelse(aus_arima$`h1`==min(aus_arima$`h1`), T, F), width = "0.7cm") %>% 
  column_spec(10, bold = ifelse(aus_arima$`h3`==min(aus_arima$`h3`), T, F), width = "0.7cm") %>% 
  column_spec(11, bold = ifelse(aus_arima$`h6`==min(aus_arima$`h6`), T, F), width = "0.7cm") %>% 
  column_spec(12, bold = ifelse(aus_arima$`h12`==min(aus_arima$`h12`), T, F), width = "0.7cm") %>% 
  column_spec(13, bold = ifelse(aus_arima$`h1-6`==min(aus_arima$`h1-6`), T, F), width = "0.7cm") %>% 
  column_spec(14, bold = ifelse(aus_arima$`h1-12`==min(aus_arima$`h1-12`), T, F), width = "0.8cm") %>% 
  row_spec(1, bold = FALSE, italic = TRUE) %>% 
  collapse_rows(1, latex_hline ="major")


state_table_arima <- state_arima %>%
  kable(escape = FALSE,
        col.names = c(" ", " ", "h = 1", "3", "6", "12", "1-6", "1-12", "h = 1", "3", "6", "12", "1-6", "1-12")
       ) %>% 
  kable_styling(full_width = FALSE,
                latex_options = c("hold_position"),
                font_size = 7) %>% 
  add_header_above(c(" "=2, "States" = 6, "States by purpose of travel" = 6), bold = TRUE)%>% 
  column_spec(c(1), width = "1.5cm") %>% 
  column_spec(c(2), width = "1cm") %>%
  column_spec(3, bold = ifelse(state_arima$`h = 1`==min(state_arima$`h = 1`), T, F), width = "0.7cm") %>% 
  column_spec(4, bold = ifelse(state_arima$`3`==min(state_arima$`3`), T, F), width = "0.7cm") %>% 
  column_spec(5, bold = ifelse(state_arima$`6`==min(state_arima$`6`), T, F), width = "0.7cm") %>% 
  column_spec(6, bold = ifelse(state_arima$`12`==min(state_arima$`12`), T, F), width = "0.7cm") %>% 
  column_spec(7, bold = ifelse(state_arima$`1-6`==min(state_arima$`1-6`), T, F), width = "0.7cm") %>% 
  column_spec(8, bold = ifelse(state_arima$`1-12`==min(state_arima$`1-12`), T, F), width = "0.7cm") %>% 
  column_spec(9, bold = ifelse(state_arima$`h1`==min(state_arima$`h1`), T, F), width = "0.7cm") %>% 
  column_spec(10, bold = ifelse(state_arima$`h3`==min(state_arima$`h3`), T, F), width = "0.7cm") %>% 
  column_spec(11, bold = ifelse(state_arima$`h6`==min(state_arima$`h6`), T, F), width = "0.7cm") %>% 
  column_spec(12, bold = ifelse(state_arima$`h12`==min(state_arima$`h12`), T, F), width = "0.7cm") %>% 
  column_spec(13, bold = ifelse(state_arima$`h1-6`==min(state_arima$`h1-6`), T, F), width = "0.7cm") %>% 
  column_spec(14, bold = ifelse(state_arima$`h1-12`==min(state_arima$`h1-12`), T, F), width = "0.7cm") %>% 
  row_spec(1, bold = FALSE, italic = TRUE) %>% 
  collapse_rows(1, latex_hline ="major")


region_table_arima <- region_arima %>%
  kable(escape = FALSE,
        col.names = c(" ", " ", "h = 1", "3", "6", "12", "1-6", "1-12", "h = 1", "3", "6", "12", "1-6", "1-12")
        ) %>% 
  kable_styling(full_width = FALSE,
                latex_options = c("hold_position"),
                font_size = 7) %>% 
  add_header_above(c(" "=2, "Regions" = 6, "Regions by purpose of travel" = 6), bold = TRUE) %>% 
  column_spec(c(1), width = "1.5cm") %>% 
  column_spec(c(2), width = "1cm") %>%
  column_spec(c(3:14), width = "1.5cm") %>%  
  column_spec(3, bold = ifelse(region_arima$`h = 1`==min(region_arima$`h = 1`), T, F), width = "0.7cm") %>% 
  column_spec(4, bold = ifelse(region_arima$`3`==min(region_arima$`3`), T, F), width = "0.7cm") %>% 
  column_spec(5, bold = ifelse(region_arima$`6`==min(region_arima$`6`), T, F), width = "0.7cm") %>% 
  column_spec(6, bold = ifelse(region_arima$`12`==min(region_arima$`12`), T, F), width = "0.7cm") %>% 
  column_spec(7, bold = ifelse(region_arima$`1-6`==min(region_arima$`1-6`), T, F), width = "0.7cm") %>% 
  column_spec(8, bold = ifelse(region_arima$`1-12`==min(region_arima$`1-12`), T, F), width = "0.7cm") %>% 
  column_spec(9, bold = ifelse(region_arima$`h1`==min(region_arima$`h1`[-1]), T, F), width = "0.7cm") %>% 
  column_spec(10, bold = ifelse(region_arima$`h3`==min(region_arima$`h3`[-1]), T, F), width = "0.7cm") %>% 
  column_spec(11, bold = ifelse(region_arima$`h6`==min(region_arima$`h6`[-1]), T, F), width = "0.7cm") %>% 
  column_spec(12, bold = ifelse(region_arima$`h12`==min(region_arima$`h12`[-1]), T, F), width = "0.7cm") %>% 
  column_spec(13, bold = ifelse(region_arima$`h1-6`==min(region_arima$`h1-6`[-1]), T, F), width = "0.7cm") %>% 
  column_spec(14, bold = ifelse(region_arima$`h1-12`==min(region_arima$`h1-12`[-1]), T, F), width = "0.7cm") %>% 
  row_spec(1, bold = FALSE, italic = TRUE) %>% 
  collapse_rows(1, latex_hline ="major")
  

allseries_table_arima <- allseries_arima %>%
  kable(escape = FALSE,
        col.names = c(" ", " ", "h = 1", "3", "6", "12", "1-6", "1-12")
        ) %>% 
  kable_styling(full_width = FALSE,
                latex_options = c("hold_position"),
                font_size = 7) %>% 
  add_header_above(c(" "=2, "All series" = 6), bold = TRUE) %>% 
  column_spec(c(1), width = "1.5cm") %>% 
  column_spec(c(2), width = "1cm") %>%
  #column_spec(c(3:8), width = "7cm") %>%  
  column_spec(3, bold = ifelse(allseries_arima$`h = 1`==min(allseries_arima$`h = 1`), T, F), width = "1.8cm") %>% 
  column_spec(4, bold = ifelse(allseries_arima$`3`==min(allseries_arima$`3`), T, F), width = "1.8cm") %>% 
  column_spec(5, bold = ifelse(allseries_arima$`6`==min(allseries_arima$`6`), T, F), width = "1.8cm") %>% 
  column_spec(6, bold = ifelse(allseries_arima$`12`==min(allseries_arima$`12`), T, F), width = "1.8cm") %>% 
  column_spec(7, bold = ifelse(allseries_arima$`1-6`==min(allseries_arima$`1-6`), T, F), width = "1.8cm") %>% 
  column_spec(8, bold = ifelse(allseries_arima$`1-12`==min(allseries_arima$`1-12`), T, F), width = "1.8cm") %>% 
  row_spec(1, bold = FALSE, italic = TRUE) %>% 
  collapse_rows(1, latex_hline ="major")


cat(paste0(aus_table_arima, "\\vspace{-2.5em}", state_table_arima, "\\vspace{-2.5em}", region_table_arima, "\\vspace{-2.5em}", allseries_table_arima), sep = "")




```


\newpage
## Plots
```{r, message=FALSE,  warning=FALSE}
cnames_chart <- c("Method", "1", "3", "6", "12", "1-3", "1-6", "1-12")

colnames(australia) <- cnames_chart
colnames(purpose) <- cnames_chart
colnames(states) <- cnames_chart
colnames(states_purpose) <- cnames_chart
colnames(regions) <- cnames_chart
colnames(regions_purpose) <- cnames_chart
colnames(all_series) <- cnames_chart

labels <- c(rep("Australia", nrow(australia) - 1),
            rep("Purpose", nrow(purpose) - 1),
            rep("States", nrow(states) - 1),
            rep("States by Purpose", nrow(states_purpose) - 1),
            rep("Regions", nrow(regions) - 1),
            rep("Regions by Purpose", nrow(regions_purpose) - 1),
            rep("All series", nrow(all_series) - 1))

series <- rbind(australia[-1, -c(6:8)], 
                purpose[-1, -c(6:8)],
                states[-1, -c(6:8)],
                states_purpose[-1, -c(6:8)],
                regions[-1, -c(6:8)],
                regions_purpose[-1, -c(6:8)],
                all_series[-1, -c(6:8)])

series$Category <- labels

series <- series %>%
  mutate(Weighting = case_when(
    grepl("ols", Method) ~ "OLS",
    grepl("wlss", Method) ~ "WLSs",
    grepl("wlsv", Method) ~ "WLSv",
    grepl("shrink", Method) ~ "MinT(Shrink)"
  ),
  Immute = case_when(
    grepl("I", Method) ~ "I",
    grepl("iMinT", Method) ~ "I-MinT"
  ))

series_long <- series %>%
  pivot_longer(cols = 2:5, 
               names_to = "Horizon", 
               values_to = "PC") 

series_long$Horizon <- factor(series_long$Horizon, 
                               levels = c("1", "3", "6", "12"))


series_long %>% 
#  filter(Weighting == "WLSv") %>% 
  filter(Category != "Australia") %>% 
  ggplot(aes(x = Horizon, y = PC, color = Weighting, group = interaction(Weighting, Immute), linetype = Immute)) +
  geom_line(linewidth = 0.4) + 
  geom_point(aes(shape = Immute), size = 1) +  # Keep points for the immutability legend
  scale_color_manual(values = c("OLS" = "blue", "WLSs" = "darkgreen", "WLSv" = "red", "MinT(Shrink)" = "orange")) + 
  scale_linetype_manual(values = c("I" = "dashed", "I-MinT" = "solid")) +
  labs(title = "Forecast Accuracies by Levels of the Structure (ETS)",
       x = "Forecast Horizon (Months)",
       y = "% Deviation from Base Forecast MSE",
       color = "W matrix",
       shape = "Immutability",
       linetype = "Immutability") +
  geom_hline(yintercept = 0, color = "black", size = 0.2) +
  theme_minimal() +
  facet_wrap(~Category, scales = "free_y", ncol = 3) +
  guides(
    color = guide_legend(override.aes = list(shape = NA)),  # Remove dots from W matrix legend
   # shape = guide_legend(override.aes = list(linetype = "blank"))  # Keep dots for Immutability legend
  ) +
  theme(
    plot.title = element_text(size = 12, face = "bold"), 
    axis.title = element_text(size = 8), 
    axis.text = element_text(size = 6),
    legend.title = element_text(size = 8, face = "bold"),  
    legend.text = element_text(size = 6),  
    strip.text = element_text(size = 6),
    aspect.ratio = 1
  )

```

&nbsp;

```{r, message=FALSE}
cnames_chart <- c("Method", "1", "3", "6", "12", "1-3", "1-6", "1-12")

colnames(australia_arima) <- cnames_chart
colnames(purpose_arima) <- cnames_chart
colnames(states_arima) <- cnames_chart
colnames(states_purpose_arima) <- cnames_chart
colnames(regions_arima) <- cnames_chart
colnames(regions_purpose_arima) <- cnames_chart
colnames(all_series_arima) <- cnames_chart

labels <- c(rep("Australia", nrow(australia_arima) - 1),
            rep("Purpose", nrow(purpose_arima) - 1),
            rep("States", nrow(states_arima) - 1),
            rep("States by Purpose", nrow(states_purpose_arima) - 1),
            rep("Regions", nrow(regions_arima) - 1),
            rep("Regions by Purpose", nrow(regions_purpose_arima) - 1),
            rep("All series", nrow(all_series_arima) - 1))

series_arima <- rbind(australia_arima[-1, -c(6:8)], 
                purpose_arima[-1, -c(6:8)],
                states_arima[-1, -c(6:8)],
                states_purpose_arima[-1, -c(6:8)],
                regions_arima[-1, -c(6:8)],
                regions_purpose_arima[-1, -c(6:8)],
                all_series_arima[-1, -c(6:8)])

series_arima$Category <- labels

series_arima <- series_arima %>%
  mutate(Weighting = case_when(
    grepl("ols", Method) ~ "OLS",
    grepl("wlss", Method) ~ "WLSs",
    grepl("wlsv", Method) ~ "WLSv",
    grepl("shrink", Method) ~ "MinT(Shrink)"
  ),
  Immute = case_when(
    grepl("I", Method) ~ "I",
    grepl("iMinT", Method) ~ "I-MinT"
  ))

series_arima_long <- series_arima %>%
  pivot_longer(cols = 2:5, 
               names_to = "Horizon", 
               values_to = "PC") 

series_arima_long$Horizon <- factor(series_arima_long$Horizon, 
                               levels = c("1", "3", "6", "12"))


series_arima_long %>% 
#  filter(Weighting == "WLSv") %>% 
  filter(Category != "Australia") %>% 
  ggplot(aes(x = Horizon, y = PC, color = Weighting, group = interaction(Weighting, Immute), linetype = Immute)) +
  geom_line(linewidth = 0.4) + 
  geom_point(aes(shape = Immute), size = 1) +  # Keep points for the immutability legend
  scale_color_manual(values = c("OLS" = "blue", "WLSs" = "darkgreen", "WLSv" = "red", "MinT(Shrink)" = "orange")) + 
  scale_linetype_manual(values = c("I" = "dashed", "I-MinT" = "solid")) +
  labs(title = "Forecast Accuracies by Levels of the Structure (ARIMA)",
       x = "Forecast Horizon (Months)",
       y = "% Deviation from Base Forecast MSE",
       color = "W matrix",
       shape = "Immutability",
       linetype = "Immutability") +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.2) +
  theme_minimal() +
  facet_wrap(~Category, scales = "free_y", ncol = 3) +
  guides(
    color = guide_legend(override.aes = list(shape = NA)),  # Remove dots from W matrix legend
   # shape = guide_legend(override.aes = list(linetype = "blank"))  # Keep dots for Immutability legend
  ) +
  theme(
    plot.title = element_text(size = 12, face = "bold"), 
    axis.title = element_text(size = 8), 
    axis.text = element_text(size = 6),
    legend.title = element_text(size = 8, face = "bold"),  
    legend.text = element_text(size = 6),  
    strip.text = element_text(size = 6),
    aspect.ratio = 1
  )

```

\newpage
```{r, fig.height=10}
series_long %>% 
#  filter(Weighting == "WLSv") %>% 
  filter(Category != "Australia") %>% 
  ggplot(aes(x = Horizon, y = PC, color = Weighting, group = interaction(Weighting, Immute), linetype = Immute)) +
  geom_line(linewidth = 0.4) + 
  geom_point(aes(shape = Immute), size = 1) +  # Keep points for the immutability legend
  scale_color_manual(values = c("OLS" = "blue", "WLSs" = "darkgreen", "WLSv" = "red", "MinT(Shrink)" = "orange")) + 
  scale_linetype_manual(values = c("I" = "dashed", "I-MinT" = "solid")) +
  labs(title = "Forecast Accuracies by Reconciliation Method (ETS)",
       x = "Forecast Horizon (Months)",
       y = "% Deviation from Base Forecast MSE",
       color = "W matrix",
       shape = "Immutability",
       linetype = "Immutability") +
  geom_hline(yintercept = 0, color = "black", size = 0.2) +
  theme_minimal() +
  facet_wrap(Category~Weighting, scales = "free_y", ncol = 4) +
  guides(
    color = guide_legend(override.aes = list(shape = NA)),  # Remove dots from W matrix legend
   # shape = guide_legend(override.aes = list(linetype = "blank"))  # Keep dots for Immutability legend
  ) +
  theme(
    plot.title = element_text(size = 12, face = "bold"), 
    axis.title = element_text(size = 8), 
    axis.text = element_text(size = 6),
    legend.title = element_text(size = 8, face = "bold"),  
    legend.text = element_text(size = 6),  
    strip.text = element_text(size = 6),
    aspect.ratio = 0.8
  )

```

\newpage
```{r, fig.height=10}
series_arima_long %>% 
#  filter(Weighting == "WLSv") %>% 
  filter(Category != "Australia") %>% 
  ggplot(aes(x = Horizon, y = PC, color = Weighting, group = interaction(Weighting, Immute), linetype = Immute)) +
  geom_line(linewidth = 0.4) + 
  geom_point(aes(shape = Immute), size = 1) +  # Keep points for the immutability legend
  scale_color_manual(values = c("OLS" = "blue", "WLSs" = "darkgreen", "WLSv" = "red", "MinT(Shrink)" = "orange")) + 
  scale_linetype_manual(values = c("I" = "dashed", "I-MinT" = "solid")) +
  labs(title = "Forecast Accuracies by Reconciliation Method (ARIMA)",
       x = "Forecast Horizon (Months)",
       y = "% Deviation from Base Forecast MSE",
       color = "W matrix",
       shape = "Immutability",
       linetype = "Immutability") +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.2) +
  theme_minimal() +
  facet_wrap(Category~Weighting, scales = "free_y", ncol = 4) +
  guides(
    color = guide_legend(override.aes = list(shape = NA)),  # Remove dots from W matrix legend
   # shape = guide_legend(override.aes = list(linetype = "blank"))  # Keep dots for Immutability legend
  ) +
  theme(
    plot.title = element_text(size = 12, face = "bold"), 
    axis.title = element_text(size = 8), 
    axis.text = element_text(size = 6),
    legend.title = element_text(size = 8, face = "bold"),  
    legend.text = element_text(size = 6),  
    strip.text = element_text(size = 6),
    aspect.ratio = 0.8
  )


```




\newpage
## Basef MSE deviations between ARIMA and ETS 

### ARIMA minus ETS for each level
```{r}
dev_aus <- australia_arima[1,-1] - australia[1,-1]
rownames(dev_aus) <- c("dev_aus")

dev_purpose <- purpose_arima[1,-1] - purpose[1,-1]
rownames(dev_purpose) <- c("dev_purpose")

dev_states <- states_arima[1,-1] - states[1,-1]
rownames(dev_states) <- c("dev_states")

dev_statespurpose <- states_purpose_arima[1,-1] - states_purpose[1,-1]
rownames(dev_statespurpose) <- c("dev_statespurpose")

dev_regions <- regions_arima[1,-1] - regions[1,-1]
rownames(dev_regions) <- c("dev_regions")

dev_regionspurpose <- regions_purpose_arima[1,-1] - regions_purpose[1,-1]
rownames(dev_regionspurpose) <- c("dev_regionspurpose")

dev_overall <- all_series_arima[1,-1] - all_series[1,-1]
rownames(dev_overall) <- c("dev_overall")


dev_aus
dev_purpose
dev_states
dev_statespurpose
dev_regions
dev_regionspurpose
dev_overall
dev_overall

```

